const ApiAutoresbot = require('api-autoresbot'); 
// Import autoresbot API client / Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¹Ù…ÙŠÙ„ API Ù„Ø£ÙˆØªÙˆØ±ÙŠØ³Ø¨ÙˆØª
const config        = require("@config"); 
// Import configuration / Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªÙƒÙˆÙŠÙ†
const { logCustom } = require("@lib/logger"); 
// Custom logger / Ù…Ø³Ø¬Ù„ Ù…Ø®ØµØµ

async function handle(sock, messageInfo) {
    const { remoteJid, message, command, content } = messageInfo;
    // Destructure message information / ÙÙƒ Ø®ØµØ§Ø¦Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø©

    try {
        // Send processing reaction / Ø¥Ø±Ø³Ø§Ù„ Ø±Ø¯ ÙØ¹Ù„ ğŸ˜ Ø¹Ù†Ø¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©
        await sock.sendMessage(remoteJid, { react: { text: "ğŸ˜", key: message.key } });

        // Create API instance / Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ù…Ù† API Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙØªØ§Ø­ API
        const api = new ApiAutoresbot(config.APIKEY);

        // Call API based on the given command / Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ API Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù…Ø± Ø§Ù„Ù…Ø±Ø³Ù„
        const response = await api.get(`/api/news/${command}`);
        
        if (response && response.data && response.data.posts && response.data.posts.length > 0) {
            const { link, title, description, thumbnail: image } = response.data.posts[0];
            const fulltext = `${title} \n\n${description} \n${link}`;

            // Send message with image and caption / Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ù…Ø¹ Ø§Ù„ØµÙˆØ±Ø© ÙˆØ§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„ÙˆØµÙ
            await sock.sendMessage(remoteJid, { image: { url: image }, caption: fulltext }, { quoted: message });
        } else {
            // Log if no data available / ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø·Ø£ Ø¥Ø°Ø§ Ù„Ù… ØªØªÙˆÙØ± Ø¨ÙŠØ§Ù†Ø§Øª
            logCustom('info', content, `ERROR-COMMAND-${command}.txt`);
            // Notify user no data available / Ø¥Ø¹Ù„Ø§Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø£Ø®Ø¨Ø§Ø±
            await sock.sendMessage(remoteJid, { text: "Sorry, no response from the server." }, { quoted: message });
        }
    } catch (error) {
        // Log error / ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø·Ø£
        logCustom('info', content, `ERROR-COMMAND-${command}.txt`);
        // Notify user of error / Ø¥Ø®Ø·Ø§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨ÙˆØ¬ÙˆØ¯ Ø®Ø·Ø£
        await sock.sendMessage(remoteJid, { 
            text: `Sorry, an error occurred while processing your request. Please try again later.\n\n${error}` 
        }, { quoted: message });
    }
}

module.exports = {
    handle,
    Commands: [
        'antara','cnn', 'cnbc', 'jpnn','kumparan','merdeka','okezone','republika', 'sindonews','tempo', 'tribun'
    ], // Supported news sources / Ø§Ù„Ù…ØµØ§Ø¯Ø± Ø§Ù„Ù…Ø¯Ø¹ÙˆÙ…Ø©
    OnlyPremium     : false, // Not limited to premium users / ØºÙŠØ± Ù…Ù‚ÙŠØ¯ Ø¨Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ù…ÙŠØ²ÙŠÙ†
    OnlyOwner       : false, // Not limited to owner / ØºÙŠØ± Ù…Ù‚ÙŠØ¯ Ø¨Ø§Ù„Ù…Ø§Ù„Ùƒ
    limitDeduction  : 1      // Amount to deduct from user limit / Ù…Ù‚Ø¯Ø§Ø± Ø§Ù„Ø®ØµÙ… Ù…Ù† Ø­Ø¯ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
};