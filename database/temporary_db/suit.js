// ===============================================
// ğŸ® Temporary database using an object
// ğŸ® Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¤Ù‚ØªØ© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙƒØ§Ø¦Ù† (Object)
// ===============================================
const DB_suit = {};

/**
 * â• Adds user data to the database
 * â• Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¥Ù„Ù‰ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
 *
 * @param {string} remoteJid - Unique user ID / Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„ÙØ±ÙŠØ¯
 * @param {object} data - User game data (random number, level, etc.)
 *                        Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ø£Ø±Ù‚Ø§Ù… Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©ØŒ Ù…Ø³ØªÙˆÙ‰ØŒ Ø¥Ù„Ø®)
 */
function addUser(remoteJid, data) {
    DB_suit[remoteJid] = data;
}

/**
 * ğŸ”„ Updates existing user data
 * ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© Ù…Ø³Ø¨Ù‚Ù‹Ø§
 *
 * @param {string} remoteJid - Unique user ID / Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„ÙØ±ÙŠØ¯
 * @param {object} newData - The new data to merge with the existing one
 *                           Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø§Ù„ØªÙŠ Ø³ÙŠØªÙ… Ø¯Ù…Ø¬Ù‡Ø§ Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
 */
function updateUser(remoteJid, newData) {
    if (DB_suit[remoteJid]) {
        // âœ… Update only fields that exist in newData
        // âœ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙ‚Ø· ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
        DB_suit[remoteJid] = { 
            ...DB_suit[remoteJid], 
            ...newData 
        };
    } else {
        console.error(`User with remoteJid ${remoteJid} not found for update.`);
        // ğŸš« Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø­Ø¯Ø¯ Ù„ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§ØªÙ‡
    }
}

/**
 * âŒ Removes user data from the database
 * âŒ Ø­Ø°Ù Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
 *
 * @param {string} remoteJid - Unique user ID / Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„ÙØ±ÙŠØ¯
 */
function removeUser(remoteJid) {
    delete DB_suit[remoteJid];
}

/**
 * ğŸ” Retrieves user data from the database
 * ğŸ” Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
 *
 * @param {string} remoteJid - Unique user ID / Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„ÙØ±ÙŠØ¯
 * @returns {object|null} - User data or null if not found
 *                          Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ null Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„ÙŠÙ‡Ø§
 */
function getUser(remoteJid) {
    return DB_suit[remoteJid] || null;
}

/**
 * ğŸ¯ Checks if a user is currently playing
 * ğŸ¯ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠÙ„Ø¹Ø¨ Ø­Ø§Ù„ÙŠÙ‹Ø§
 *
 * @param {string} remoteJid - Unique user ID / Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„ÙØ±ÙŠØ¯
 * @returns {boolean} - True if the user exists in the database, false otherwise
 *                      ØµØ­ÙŠØ­ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯Ù‹Ø§ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ Ø®Ø·Ø£ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† ÙƒØ°Ù„Ùƒ
 */
function isUserPlaying(remoteJid) {
    return Boolean(DB_suit[remoteJid]);
}

/**
 * ğŸ” Finds user data by a specific key-value pair
 * ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙØªØ§Ø­ ÙˆÙ‚ÙŠÙ…Ø© Ù…Ø­Ø¯Ø¯ÙŠÙ†
 *
 * @param {object} searchCriteria - The key-value pair to search for (e.g., {name: "Ali"})
 *                                  ÙƒØ§Ø¦Ù† ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù…ÙØªØ§Ø­ ÙˆÙ‚ÙŠÙ…Ø© Ù„Ù„Ø¨Ø­Ø« (Ù…Ø«Ù„ {name: "Ali"})
 * @returns {object|null} - Returns user data that matches the search or null if not found
 *                          ÙŠØ¹ÙŠØ¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ø£Ùˆ null Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„ÙŠÙ‡Ø§
 */
function findDataByKey(searchCriteria) {
    const key = Object.keys(searchCriteria)[0]; // ğŸ—ï¸ Get the key from the object
    // ğŸ—ï¸ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙØªØ§Ø­ Ù…Ù† Ø§Ù„ÙƒØ§Ø¦Ù†
    let value = searchCriteria[key]; // Get the value to match / Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù‚ÙŠÙ…Ø© Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø©

    // âš™ï¸ If the value is empty, undefined, or null, set it to null
    // âš™ï¸ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù‚ÙŠÙ…Ø© ÙØ§Ø±ØºØ© Ø£Ùˆ ØºÙŠØ± Ù…Ø¹Ø±ÙØ© Ø£Ùˆ nullØŒ Ø§Ø¬Ø¹Ù„Ù‡Ø§ null
    if (value === "" || value === undefined || value === null) {
        value = null;
    }

    // ğŸ” Loop through all users in the database
    // ğŸ” Ø§Ù„Ù…Ø±ÙˆØ± Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    for (const remoteJid in DB_suit) {
        if (DB_suit[remoteJid][key] === value) {
            return {
                remoteJid,
                ...DB_suit[remoteJid],
            }; // âœ… Return the data directly without array / âœ… Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¨Ø§Ø´Ø±Ø© Ø¯ÙˆÙ† Ù…ØµÙÙˆÙØ©
        }
    }

    return null; // ğŸš« If no match found / ğŸš« Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£ÙŠ ØªØ·Ø§Ø¨Ù‚
}

// ===============================================
// ğŸ“¤ Export functions and database
// ğŸ“¤ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¯ÙˆØ§Ù„ ÙˆÙ‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
// ===============================================
module.exports = {
    DB_suit,        // Temporary in-memory database / Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¤Ù‚ØªØ© ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø©
    addUser,        // Add user data / Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    removeUser,     // Remove user data / Ø­Ø°Ù Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    getUser,        // Retrieve user data / Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    isUserPlaying,  // Check if user is playing / Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠÙ„Ø¹Ø¨
    findDataByKey,  // Find data by key / Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨ÙˆØ§Ø³Ø·Ø© Ù…ÙØªØ§Ø­
    updateUser      // Update existing user data / ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©
};